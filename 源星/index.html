<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æºæ˜Ÿçƒ</title>
    <style>
        /* Toast æç¤ºæ ·å¼ */
        .toast-container {
            position: fixed;
            top: 50px;
            left: 20px;
            z-index: 1000;
        }

        .toast {
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 4px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid #4CAF50;
        }

        .toast-info {
            border-left: 4px solid #2196F3;
        }

        .toast-error {
            border-left: 4px solid #f44336;
        }

        /* ä¿æŒåŸæœ‰æ ·å¼ä¸å˜ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-size: 12.5px;
            color: #454545;
        }

        body,
        html {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        .åŸºæœ¬å— {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: rgba(209, 208, 208, 0.4);
        }

        .é¡¶éƒ¨å— {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f4ff;
            position: relative;
            padding: 10px;
        }

        .é¡¶éƒ¨å— h1 {
            font-size: 18px;
            font-weight: bold;
        }

        .é¡¶éƒ¨å— .logo {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
        }

        .åº•éƒ¨å— {
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #f0f4ff;
            padding: 10px;
            position: relative;
            z-index: 10;
        }

        .åŠŸèƒ½å— {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            position: relative;
            z-index: 1;
            padding: 8px 15px;
        }

        .åŠŸèƒ½å— img {
            width: 20px;
            height: 20px;
        }

        .åŠŸèƒ½å— span {
            font-size: 10.5px;
        }

        /* æ·»åŠ è§¦æ‘¸åé¦ˆæ•ˆæœ */
        .åŠŸèƒ½å—:active {
            opacity: 0.7;
            transform: scale(0.95);
        }

        .å†…å®¹å— {
            width: calc(100% - 20px);
            margin: 10px auto;
            display: grid;
            gap: 15px;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .å†…å®¹å—::-webkit-scrollbar {
            display: none;
        }

        .èµ„æºå— {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .èµ„æºå— .æ—¥æœŸ {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 12px;
            color: #666;
        }

        .èµ„æºå— .æ ‡é¢˜ {
            margin-top: 30px;
            font-weight: bold;
        }

        .èµ„æºè¡¨æ ¼ {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .èµ„æºè¡¨æ ¼ th,
        .èµ„æºè¡¨æ ¼ td {
            border: 1px solid #e0e0e0;
            padding: 5px;
            white-space: nowrap;
            overflow: hidden;
        }

        .èµ„æºè¡¨æ ¼ th {
            background-color: #f5f5f5;
            text-align: center;
        }

        .èµ„æºè¡¨æ ¼ .url-cell {
            text-align: left;
            max-width: 200px;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: none;
        }

        .èµ„æºè¡¨æ ¼ .url-cell::-webkit-scrollbar {
            display: none;
        }

        .èµ„æºè¡¨æ ¼ .copy-cell {
            width: 40px;
            text-align: center;
        }

        .å¤åˆ¶æŒ‰é’® {
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }

        .å¤åˆ¶æŒ‰é’®:hover {
            background-color: #45a049;
        }

        /* åœ¨å·²æœ‰çš„æ ·å¼è¡¨ä¸­æ·»åŠ  */
        .å¤åˆ¶æŒ‰é’®.å†·å´ä¸­ {
            background-color: #e0e0e0;
            cursor: not-allowed;
            color: #666;
        }

        .çŠ¶æ€æŒ‰é’® {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 10.5px;
        }

        .çŠ¶æ€æŒ‰é’®.å†·å´ä¸­ {
            cursor: not-allowed;
            opacity: 0.5;
            font-size: 12.5px;
        }

        .é™„åŠ ä¿¡æ¯ {
            margin-top: 10px;
            font-size: 10.5px;
            color: #666;
        }

        /* æœç´¢å¼¹çª—æ ·å¼ */
        .æœç´¢å¼¹çª— {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 400px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            padding: 20px;
            display: none;
        }

        .æœç´¢å¼¹çª—.æ˜¾ç¤º {
            display: block;
        }

        .æœç´¢å¼¹çª— h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .æœç´¢è¾“å…¥æ¡† {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
        }

        .æœç´¢æŒ‰é’®å— {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .æœç´¢æŒ‰é’®å— button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .æœç´¢æŒ‰é’®å— .å–æ¶ˆæŒ‰é’® {
            background-color: #f44336;
            color: white;
        }

        .æœç´¢æŒ‰é’®å— .ç¡®è®¤æŒ‰é’® {
            background-color: #4CAF50;
            color: white;
        }

        .å¼¹çª—è’™ç‰ˆ {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .å¼¹çª—è’™ç‰ˆ.active {
            display: block;
        }

        /* åª’ä½“æŸ¥è¯¢ */
        @media (min-width: 769px) {

            /* ç”µè„‘ç«¯æ ·å¼ */
            .å†…å®¹å— {
                grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            }
        }

        @media (max-width: 768px) {

            /* æ‰‹æœºç«¯æ ·å¼ */
            .å†…å®¹å— {
                grid-template-columns: repeat(auto-fit, minmax(95%, 1fr));
            }
        }
    </style>
    <link rel="stylesheet" href="gonggao/styles.css">
</head>

<body>
    <div class="overlay">
        <div class="å…¬å‘Šå¼¹çª—">
            <h2>æ‚¨å¥½ï¼Œæºæ˜Ÿäºº(,,ï½¥âˆ€ï½¥)ï¾‰ã‚›</h2>
            <div class="å…¬å‘Šå¼¹çª—å†…å®¹">
                <p>æœ¬é¡µæ‰€æœ‰èµ„"æº"å‡æ¥è‡ªäºç½‘ç»œæ¬è¿å’Œç½‘å‹æŠ•ç¨¿ï¼è¯·åˆç†ä½¿ç”¨ï¼Œå‹¿æ»¥ä¼ æ»¥ç”¨ã€‚åŒæ—¶ä¹Ÿæ³è¯·æ‚¨å°Šé‡çŸ¥è¯†äº§æƒï¼Œéµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚</p>
            </div>
            <div class="å…¬å‘Šå¼¹çª—æŒ‰é’®å—">
                <button class="å…¬å‘Šå¼¹çª—æŒ‰é’® å…¬å‘Šå¼¹çª—å–æ¶ˆæŒ‰é’®">å–æ¶ˆ</button>
                <button class="å…¬å‘Šå¼¹çª—æŒ‰é’® å…¬å‘Šå¼¹çª—ç¡®è®¤æŒ‰é’®">ç¡®è®¤</button>
            </div>
        </div>
    </div>
    <div class="åŸºæœ¬å—">
        <div class="é¡¶éƒ¨å—">
            <h1>æºæ˜Ÿçƒ</h1>
            <a href="https://www.quruanpu.cn/"><img src="zhuye.png" alt="ä¸»é¡µLogo" class="logo"></a>
        </div>
        <div class="å¼¹çª—è’™ç‰ˆ"></div>
        <div class="å†…å®¹å—">
            <!-- èµ„æºå—å°†åœ¨æ­¤åŠ¨æ€åŠ è½½ -->
        </div>

        <div class="toast-container">
            <!-- Toast æç¤ºå°†åœ¨è¿™é‡ŒåŠ¨æ€æ’å…¥ -->
        </div>

        <div class="åº•éƒ¨å—">
            <div class="åŠŸèƒ½å—" id="æŠ•ç¨¿å—">
                <img src="tougao.png" alt="æŠ•ç¨¿">
                <span>æŠ•ç¨¿</span>
            </div>
            <div class="åŠŸèƒ½å—" id="æœç´¢å—">
                <img src="sousuo.png" alt="æœç´¢">
                <span>æœç´¢</span>
            </div>
            <div class="åŠŸèƒ½å—" id="åº”ç”¨å—">
                <img src="yingyong.png" alt="åº”ç”¨">
                <span>åº”ç”¨</span>
            </div>
        </div>
        <div class="æœç´¢å¼¹çª—">
            <h2>æ‚¨å¥½ï¼Œæºæ˜Ÿäººï¼</h2>
            <input type="text" class="æœç´¢è¾“å…¥æ¡†" placeholder="å¤šå…³é”®å­—ç”¨â€œ,â€æˆ–â€œ|â€åˆ†éš”ï¼å‰è€…ä¸ºå¹¶ï¼Œåè€…ä¸ºæˆ–......">
            <div class="æœç´¢æŒ‰é’®å—">
                <button class="å–æ¶ˆæŒ‰é’®">å–æ¶ˆ</button>
                <button class="ç¡®è®¤æŒ‰é’®">ç¡®è®¤</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-database-compat.min.js"></script>

    <script>
        // Firebase é…ç½®
        function decrypt(encryptedConfig) {
            const key = 'YXingQiu2024';
            let decrypted = '';
            const base64 = atob(encryptedConfig);
            for (let i = 0; i < base64.length; i++) {
                decrypted += String.fromCharCode(base64.charCodeAt(i) ^ key.charCodeAt(i % key.length));
            }
            return JSON.parse(decrypted);
        }

        const encryptedConfig = "InoIHg4aDAwQChB1ECIIPR4VDhZ7YHFBYDpaHggiGBxmBGZMH2A/AT1pIUJTVXNWLjdLQkUwHAFadF1ZODEHTF1zEA1bXlVFMC1EC1Q1WRQcVltGPDoIHQIwGQUcU11Ze3RLCgYlCBdTQ1dhCxRLVEU5HQFCQwgbdiERBwk2GBxHHVcHPWgIQwM0DxRHXEYZKywNDEk3AAdXUlNHPDEGQAQ+BFceEkJGNjIMDRMYDVcIEktMMDYOHw4kRBABVAJVe3RLHRM+GxRVVXBBOjMMGkVrSwxKWVxTKDEcQwJiDUVTHlNEKSsZARN/ChpfEh4WND0aHQY2ABtVY1daPT0bJwNzU1cFAwsNYGhfW1dlX0YQHBBVKSggCkVrS0QIBwENYGFZWFJhXUMBCkVRO2JRXQEzCBYKVQMBaDlbClJmC01XBVdVe3RLAwIwGgBAVV9RNywgCkVrSzIffnQHAQoiPl9pWVdP";

        // åˆå§‹åŒ– Firebase
        const firebaseConfig = decrypt(encryptedConfig);
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let å½“å‰æœç´¢çŠ¶æ€ = {
            æ˜¯å¦æœç´¢ä¸­: false,
            å…³é”®å­—: '',
            æœç´¢æ¨¡å¼: 'or'
        };

        // åœ¨ Firebase é…ç½®ä¹‹åï¼Œæ·»åŠ è¿™äº›å·¥å…·å‡½æ•°
        function è·å–æŒ‰é’®å†·å´çŠ¶æ€(èµ„æºID) {
            const å­˜å‚¨çš„æ•°æ® = localStorage.getItem(`copyButtonCooldown_${èµ„æºID}`);
            if (!å­˜å‚¨çš„æ•°æ®) return null;

            const æ•°æ® = JSON.parse(å­˜å‚¨çš„æ•°æ®);
            if (æ•°æ®.ç»“æŸæ—¶é—´ <= Date.now()) {
                localStorage.removeItem(`copyButtonCooldown_${èµ„æºID}`);
                return null;
            }
            return æ•°æ®;
        }

        function è®¾ç½®æŒ‰é’®å†·å´çŠ¶æ€(èµ„æºID, ç§’æ•°) {
            const æ•°æ® = {
                å¼€å§‹æ—¶é—´: Date.now(),
                ç»“æŸæ—¶é—´: Date.now() + (ç§’æ•° * 1000)
            };
            localStorage.setItem(`copyButtonCooldown_${èµ„æºID}`, JSON.stringify(æ•°æ®));
        }

        function ç§»é™¤æŒ‰é’®å†·å´çŠ¶æ€(èµ„æºID) {
            localStorage.removeItem(`copyButtonCooldown_${èµ„æºID}`);
        }

        // Toast æç¤ºå‡½æ•°
        function showToast(message, type = 'success') {
            const toastContainer = document.querySelector('.toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;

            toastContainer.appendChild(toast);

            // è§¦å‘é‡æ’ä»¥åº”ç”¨è¿‡æ¸¡æ•ˆæœ
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            // 3ç§’åç§»é™¤æç¤º
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // åˆ›å»ºèµ„æºå—çš„å‡½æ•°
        function åˆ›å»ºèµ„æºå—(èµ„æºæ•°æ®) {
            const èµ„æºå— = document.createElement('div');
            èµ„æºå—.classList.add('èµ„æºå—');

            // è®¾ç½®çŠ¶æ€å›¾æ ‡
            const çŠ¶æ€å›¾æ ‡ = èµ„æºæ•°æ®.state === "æœ‰æ•ˆ" ? "â­ï¸" : "ğŸ”´";

            èµ„æºå—.innerHTML = `
                <div class="æ—¥æœŸ">${èµ„æºæ•°æ®.date}</div>
                <div class="çŠ¶æ€æŒ‰é’®">${çŠ¶æ€å›¾æ ‡}</div>
                <div class="æ ‡é¢˜">ğŸ’¡ ${èµ„æºæ•°æ®.title}</div>
                <table class="èµ„æºè¡¨æ ¼">
                    <tr>
                        <th>æ˜Ÿå€</th>
                        <th>æ“ä½œ</th>
                    </tr>
                    <tr>
                        <td class="url-cell">${èµ„æºæ•°æ®.url}</td>
                        <td class="copy-cell">
                            <button class="å¤åˆ¶æŒ‰é’®">å¤åˆ¶</button>
                        </td>
                    </tr>
                </table>
                <div class="é™„åŠ ä¿¡æ¯">
                     ${èµ„æºæ•°æ®.user ? `(ç”¨æˆ·:${èµ„æºæ•°æ®.user})` : ''}${èµ„æºæ•°æ®.tag ? `(æ ‡ç­¾:${èµ„æºæ•°æ®.tag})` : ''} ${èµ„æºæ•°æ®.app ? `(é€‚ç”¨:${èµ„æºæ•°æ®.app})` : ''} ${èµ„æºæ•°æ®.number ? `(æºæ•°é‡:${èµ„æºæ•°æ®.number})` : ''} ${èµ„æºæ•°æ®.copy ? `(å·²å¤åˆ¶:${èµ„æºæ•°æ®.copy})` : ''}
                </div>
            `;

            // å¤åˆ¶æŒ‰é’®åŠŸèƒ½
            const å¤åˆ¶æŒ‰é’® = èµ„æºå—.querySelector('.å¤åˆ¶æŒ‰é’®');
            const åˆå§‹å†·å´çŠ¶æ€ = è·å–æŒ‰é’®å†·å´çŠ¶æ€(èµ„æºæ•°æ®.id);

            // å¦‚æœæœ‰ä¿å­˜çš„å†·å´çŠ¶æ€ï¼Œæ¢å¤å®ƒ
            if (åˆå§‹å†·å´çŠ¶æ€) {
                const å‰©ä½™æ¯«ç§’ = åˆå§‹å†·å´çŠ¶æ€.ç»“æŸæ—¶é—´ - Date.now();
                const å‰©ä½™ç§’æ•° = Math.ceil(å‰©ä½™æ¯«ç§’ / 1000);

                if (å‰©ä½™ç§’æ•° > 0) {
                    å¤åˆ¶æŒ‰é’®.classList.add('å†·å´ä¸­');
                    å¤åˆ¶æŒ‰é’®.textContent = `${å‰©ä½™ç§’æ•°}s`;

                    const timer = setInterval(() => {
                        const å½“å‰å‰©ä½™ç§’æ•° = Math.ceil((åˆå§‹å†·å´çŠ¶æ€.ç»“æŸæ—¶é—´ - Date.now()) / 1000);

                        if (å½“å‰å‰©ä½™ç§’æ•° <= 0) {
                            clearInterval(timer);
                            å¤åˆ¶æŒ‰é’®.classList.remove('å†·å´ä¸­');
                            å¤åˆ¶æŒ‰é’®.textContent = 'å¤åˆ¶';
                            ç§»é™¤æŒ‰é’®å†·å´çŠ¶æ€(èµ„æºæ•°æ®.id);
                        } else {
                            å¤åˆ¶æŒ‰é’®.textContent = `${å½“å‰å‰©ä½™ç§’æ•°}s`;
                        }
                    }, 1000);
                }
            }

            // ä¿®æ”¹å¤åˆ¶æŒ‰é’®çš„ç‚¹å‡»å¤„ç†å‡½æ•°éƒ¨åˆ†
            å¤åˆ¶æŒ‰é’®.addEventListener('click', async () => {
                // æ£€æŸ¥å†·å´çŠ¶æ€
                const å½“å‰å†·å´çŠ¶æ€ = è·å–æŒ‰é’®å†·å´çŠ¶æ€(èµ„æºæ•°æ®.id);
                if (å½“å‰å†·å´çŠ¶æ€) {
                    const å‰©ä½™æ¯«ç§’ = å½“å‰å†·å´çŠ¶æ€.ç»“æŸæ—¶é—´ - Date.now();
                    if (å‰©ä½™æ¯«ç§’ > 0) {
                        showToast(`è¯·ç­‰å¾…${Math.ceil(å‰©ä½™æ¯«ç§’ / 1000)}ç§’åå†å¤åˆ¶`, 'info');
                        return;
                    }
                }

                try {
                    let copySuccess = false;

                    // æ–¹æ³•1ï¼šå°è¯•ä½¿ç”¨ Clipboard API
                    if (navigator.clipboard && window.isSecureContext) {
                        try {
                            await navigator.clipboard.writeText(èµ„æºæ•°æ®.url);
                            copySuccess = true;
                        } catch (err) {
                            console.log('Clipboard API failed, trying alternative method');
                        }
                    }

                    // æ–¹æ³•2ï¼šå¦‚æœæ–¹æ³•1å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ execCommand
                    if (!copySuccess) {
                        const textarea = document.createElement('textarea');
                        textarea.value = èµ„æºæ•°æ®.url;
                        // ä¸€äº›é‡è¦çš„æ ·å¼è®¾ç½®
                        textarea.style.cssText = 'position:fixed;opacity:0;z-index:-1;pointer-events:none;';
                        document.body.appendChild(textarea);

                        if (navigator.userAgent.match(/iphone|ipad|ipod/i)) {
                            // iOS è®¾å¤‡ç‰¹æ®Šå¤„ç†
                            const range = document.createRange();
                            range.selectNodeContents(textarea);
                            const selection = window.getSelection();
                            selection.removeAllRanges();
                            selection.addRange(range);
                            textarea.setSelectionRange(0, 999999);
                        } else {
                            // å…¶ä»–è®¾å¤‡
                            textarea.select();
                        }

                        try {
                            document.execCommand('copy');
                            copySuccess = true;
                        } catch (err) {
                            console.log('execCommand failed');
                        }

                        document.body.removeChild(textarea);
                    }

                    // æ–¹æ³•3ï¼šå¦‚æœå‰ä¸¤ç§æ–¹æ³•éƒ½å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ document.execCommand çš„å¦ä¸€ç§æ–¹å¼
                    if (!copySuccess) {
                        const container = document.createElement('div');
                        container.innerHTML = èµ„æºæ•°æ®.url;
                        container.style.cssText = 'position:fixed;opacity:0;z-index:-1;pointer-events:none;';
                        document.body.appendChild(container);

                        const range = document.createRange();
                        range.selectNode(container);
                        window.getSelection().removeAllRanges();
                        window.getSelection().addRange(range);

                        try {
                            document.execCommand('copy');
                            copySuccess = true;
                        } catch (err) {
                            console.log('Alternative execCommand failed');
                        }

                        document.body.removeChild(container);
                    }

                    if (!copySuccess) {
                        throw new Error('æ‰€æœ‰å¤åˆ¶æ–¹æ³•éƒ½å¤±è´¥äº†');
                    }

                    // å¤åˆ¶æˆåŠŸåçš„å¤„ç†
                    å¤åˆ¶æŒ‰é’®.classList.add('å†·å´ä¸­');
                    let å‰©ä½™ç§’æ•° = 30;
                    å¤åˆ¶æŒ‰é’®.textContent = `${å‰©ä½™ç§’æ•°}s`;
                    è®¾ç½®æŒ‰é’®å†·å´çŠ¶æ€(èµ„æºæ•°æ®.id, 30);

                    const timer = setInterval(() => {
                        å‰©ä½™ç§’æ•°--;
                        if (å‰©ä½™ç§’æ•° <= 0) {
                            clearInterval(timer);
                            å¤åˆ¶æŒ‰é’®.classList.remove('å†·å´ä¸­');
                            å¤åˆ¶æŒ‰é’®.textContent = 'å¤åˆ¶';
                            ç§»é™¤æŒ‰é’®å†·å´çŠ¶æ€(èµ„æºæ•°æ®.id);
                        } else {
                            å¤åˆ¶æŒ‰é’®.textContent = `${å‰©ä½™ç§’æ•°}s`;
                        }
                    }, 1000);

                    // æ›´æ–° Firebase æ•°æ®
                    const resourceRef = database.ref(`resources/${èµ„æºæ•°æ®.id}`);
                    const snapshot = await resourceRef.child('copy').once('value');
                    let currentCopy = snapshot.val();
                    if (!currentCopy || isNaN(parseInt(currentCopy))) {
                        currentCopy = "0";
                    }
                    const newCopy = (parseInt(currentCopy) + 1).toString();
                    await resourceRef.child('copy').set(newCopy);
                    showToast('é“¾æ¥å¤åˆ¶æˆåŠŸï¼', 'success');

                } catch (error) {
                    console.error('å¤åˆ¶å¤±è´¥:', error);
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·é•¿æŒ‰å†…å®¹æ‰‹åŠ¨å¤åˆ¶', 'error');
                    å¤åˆ¶æŒ‰é’®.classList.remove('å†·å´ä¸­');
                    å¤åˆ¶æŒ‰é’®.textContent = 'å¤åˆ¶';
                    ç§»é™¤æŒ‰é’®å†·å´çŠ¶æ€(èµ„æºæ•°æ®.id);
                }
            });

            // çŠ¶æ€æŒ‰é’®åŠŸèƒ½
            const çŠ¶æ€æŒ‰é’® = èµ„æºå—.querySelector('.çŠ¶æ€æŒ‰é’®');

            // æ£€æŸ¥åˆå§‹å†·å´çŠ¶æ€
            const çŠ¶æ€æŒ‰é’®åˆå§‹å†·å´çŠ¶æ€ = è·å–æŒ‰é’®å†·å´çŠ¶æ€(`state_${èµ„æºæ•°æ®.id}`);
            if (çŠ¶æ€æŒ‰é’®åˆå§‹å†·å´çŠ¶æ€) {
                const å‰©ä½™æ¯«ç§’ = çŠ¶æ€æŒ‰é’®åˆå§‹å†·å´çŠ¶æ€.ç»“æŸæ—¶é—´ - Date.now();
                const å‰©ä½™ç§’æ•° = Math.ceil(å‰©ä½™æ¯«ç§’ / 1000);

                if (å‰©ä½™ç§’æ•° > 0) {
                    çŠ¶æ€æŒ‰é’®.classList.add('å†·å´ä¸­');
                    çŠ¶æ€æŒ‰é’®.textContent = `${å‰©ä½™ç§’æ•°}s`;

                    const timer = setInterval(() => {
                        const å½“å‰å‰©ä½™ç§’æ•° = Math.ceil((çŠ¶æ€æŒ‰é’®åˆå§‹å†·å´çŠ¶æ€.ç»“æŸæ—¶é—´ - Date.now()) / 1000);

                        if (å½“å‰å‰©ä½™ç§’æ•° <= 0) {
                            clearInterval(timer);
                            çŠ¶æ€æŒ‰é’®.classList.remove('å†·å´ä¸­');
                            çŠ¶æ€æŒ‰é’®.textContent = èµ„æºæ•°æ®.state === "æœ‰æ•ˆ" ? "â­ï¸" : "ğŸ”´";
                            ç§»é™¤æŒ‰é’®å†·å´çŠ¶æ€(`state_${èµ„æºæ•°æ®.id}`);
                        } else {
                            çŠ¶æ€æŒ‰é’®.textContent = `${å½“å‰å‰©ä½™ç§’æ•°}s`;
                        }
                    }, 1000);
                }
            }

            çŠ¶æ€æŒ‰é’®.addEventListener('click', () => {
                // æ£€æŸ¥å†·å´çŠ¶æ€
                const å½“å‰å†·å´çŠ¶æ€ = è·å–æŒ‰é’®å†·å´çŠ¶æ€(`state_${èµ„æºæ•°æ®.id}`);
                if (å½“å‰å†·å´çŠ¶æ€) {
                    const å‰©ä½™æ¯«ç§’ = å½“å‰å†·å´çŠ¶æ€.ç»“æŸæ—¶é—´ - Date.now();
                    if (å‰©ä½™æ¯«ç§’ > 0) {
                        showToast(`è¯·ç­‰å¾…${Math.ceil(å‰©ä½™æ¯«ç§’ / 1000)}ç§’åå†åˆ‡æ¢çŠ¶æ€`, 'info');
                        return;
                    }
                }

                // è®¡ç®—æ–°çŠ¶æ€
                const newState = èµ„æºæ•°æ®.state === "æœ‰æ•ˆ" ? "æ— æ•ˆ" : "æœ‰æ•ˆ";

                // å…ˆå¼€å§‹å†·å´ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
                çŠ¶æ€æŒ‰é’®.classList.add('å†·å´ä¸­');
                let å‰©ä½™ç§’æ•° = 30;
                çŠ¶æ€æŒ‰é’®.textContent = `${å‰©ä½™ç§’æ•°}s`;
                è®¾ç½®æŒ‰é’®å†·å´çŠ¶æ€(`state_${èµ„æºæ•°æ®.id}`, 30);

                // æ›´æ–°æ•°æ®åº“
                const resourceRef = database.ref(`resources/${èµ„æºæ•°æ®.id}`);
                resourceRef.child('state').set(newState)
                    .then(() => {
                        èµ„æºæ•°æ®.state = newState; // æ›´æ–°æœ¬åœ°çŠ¶æ€
                        showToast(`å·²æ ‡è®°æ˜Ÿçƒä¸º${newState}çŠ¶æ€ï¼`, 'success');

                        // åˆ›å»ºå†·å´å®šæ—¶å™¨
                        const timer = setInterval(() => {
                            å‰©ä½™ç§’æ•°--;
                            if (å‰©ä½™ç§’æ•° <= 0) {
                                clearInterval(timer);
                                çŠ¶æ€æŒ‰é’®.classList.remove('å†·å´ä¸­');
                                çŠ¶æ€æŒ‰é’®.textContent = newState === "æœ‰æ•ˆ" ? "â­ï¸" : "ğŸ”´";
                                ç§»é™¤æŒ‰é’®å†·å´çŠ¶æ€(`state_${èµ„æºæ•°æ®.id}`);
                            } else {
                                çŠ¶æ€æŒ‰é’®.textContent = `${å‰©ä½™ç§’æ•°}s`;
                            }
                        }, 1000);
                    })
                    .catch((error) => {
                        console.error('çŠ¶æ€æ›´æ–°å¤±è´¥:', error);
                        showToast('çŠ¶æ€æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                        // å¦‚æœæ›´æ–°å¤±è´¥ï¼Œå–æ¶ˆå†·å´çŠ¶æ€
                        çŠ¶æ€æŒ‰é’®.classList.remove('å†·å´ä¸­');
                        çŠ¶æ€æŒ‰é’®.textContent = èµ„æºæ•°æ®.state === "æœ‰æ•ˆ" ? "â­ï¸" : "ğŸ”´";
                        ç§»é™¤æŒ‰é’®å†·å´çŠ¶æ€(`state_${èµ„æºæ•°æ®.id}`);
                    });
            });

            return èµ„æºå—;
        }

        function åŠ è½½èµ„æºå—() {
            const å†…å®¹å— = document.querySelector('.å†…å®¹å—');
            å†…å®¹å—.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            // ä» Firebase è·å–æ•°æ®å¹¶å®æ—¶ç›‘å¬
            const resourcesRef = database.ref('resources');
            // æ·»åŠ æŸ¥è¯¢æ¡ä»¶ï¼šåªæŸ¥æ‰¾ status ä¸º"å·²å®¡æ ¸"çš„è®°å½•
            resourcesRef.orderByChild('status').equalTo('å·²å®¡æ ¸').on('value', (snapshot) => {
                const data = snapshot.val();
                å†…å®¹å—.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

                if (data) {
                    // å°†æ•°æ®è½¬åŒ–ä¸ºæ•°ç»„å¹¶æ’åº
                    const sortedData = Object.entries(data)
                        .map(([id, resource]) => ({ ...resource, id }))
                        .sort((a, b) => new Date(b.date) - new Date(a.date)); // æŒ‰æ—¥æœŸé™åºæ’åº

                    // åŠ è½½æ’åºåçš„æ•°æ®
                    sortedData.forEach(resource => {
                        if (resource.status === 'å·²å®¡æ ¸') {
                            å†…å®¹å—.appendChild(åˆ›å»ºèµ„æºå—(resource));
                        }
                    });

                    // é‡è¦ï¼šå¦‚æœæ­£åœ¨æœç´¢ä¸­ï¼Œé‡æ–°åº”ç”¨æœç´¢è¿‡æ»¤
                    if (å½“å‰æœç´¢çŠ¶æ€.æ˜¯å¦æœç´¢ä¸­) {
                        æœç´¢èµ„æº(å½“å‰æœç´¢çŠ¶æ€.å…³é”®å­—, å½“å‰æœç´¢çŠ¶æ€.æœç´¢æ¨¡å¼);
                    }

                    // å¦‚æœå†…å®¹å—ä¸ºç©ºï¼ˆæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼‰
                    if (å†…å®¹å—.children.length === 0) {
                        const noDataMsg = document.createElement('div');
                        noDataMsg.style.textAlign = 'center';
                        noDataMsg.style.padding = '20px';
                        noDataMsg.style.color = '#666';
                        noDataMsg.textContent = 'æš‚æ— å·²å®¡æ ¸çš„èµ„æº';
                        å†…å®¹å—.appendChild(noDataMsg);
                    }
                } else {
                    // å¦‚æœæ²¡æœ‰ä»»ä½•è®°å½•ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                    const noDataMsg = document.createElement('div');
                    noDataMsg.style.textAlign = 'center';
                    noDataMsg.style.padding = '20px';
                    noDataMsg.style.color = '#666';
                    noDataMsg.textContent = 'æš‚æ— å·²å®¡æ ¸çš„èµ„æº';
                    å†…å®¹å—.appendChild(noDataMsg);
                }
            }, (error) => {
                console.error("æ•°æ®åŠ è½½é”™è¯¯:", error);
                showToast('æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            });
        }

        // æœç´¢åŠŸèƒ½
        function æœç´¢èµ„æº(å…³é”®å­—, æœç´¢æ¨¡å¼) {
            const å†…å®¹å— = document.querySelector('.å†…å®¹å—');
            const èµ„æºå—åˆ—è¡¨ = å†…å®¹å—.querySelectorAll('.èµ„æºå—');

            å…³é”®å­— = å…³é”®å­—.trim().split(/[,ï¼Œ|]/);

            èµ„æºå—åˆ—è¡¨.forEach(èµ„æºå— => {
                const èµ„æºæ•°æ® = èµ„æºå—.querySelector('.é™„åŠ ä¿¡æ¯').textContent;
                const æ ‡é¢˜ = èµ„æºå—.querySelector('.æ ‡é¢˜').textContent;
                const URL = èµ„æºå—.querySelector('.url-cell').textContent;
                const æ—¥æœŸ = èµ„æºå—.querySelector('.æ—¥æœŸ').textContent;
                const çŠ¶æ€æŒ‰é’® = èµ„æºå—.querySelector('.çŠ¶æ€æŒ‰é’®').textContent;

                let åŒ¹é… = æœç´¢æ¨¡å¼ === 'and'
                    ? å…³é”®å­—.every(k =>
                        èµ„æºæ•°æ®.includes(k) ||
                        æ ‡é¢˜.includes(k) ||
                        URL.includes(k) ||
                        çŠ¶æ€æŒ‰é’®.includes(k) ||
                        æ—¥æœŸ.includes(k)
                    )
                    : å…³é”®å­—.some(k =>
                        èµ„æºæ•°æ®.includes(k) ||
                        æ ‡é¢˜.includes(k) ||
                        URL.includes(k) ||
                        çŠ¶æ€æŒ‰é’®.includes(k) ||
                        æ—¥æœŸ.includes(k)
                    );

                èµ„æºå—.style.display = åŒ¹é… ? 'block' : 'none';
            });
        }

        // æ›¿æ¢åŸæœ‰çš„åº•éƒ¨æŒ‰é’®ç›¸å…³ä»£ç ä¸ºä»¥ä¸‹å®Œæ•´ä»£ç 
        function initializeBottomButtons() {
            const æŠ•ç¨¿å— = document.getElementById('æŠ•ç¨¿å—');
            const æœç´¢å— = document.getElementById('æœç´¢å—');
            const åº”ç”¨å— = document.getElementById('åº”ç”¨å—');
            const æœç´¢å¼¹çª— = document.querySelector('.æœç´¢å¼¹çª—');
            const æœç´¢è¾“å…¥æ¡† = document.querySelector('.æœç´¢è¾“å…¥æ¡†');
            const ç¡®è®¤æŒ‰é’® = document.querySelector('.ç¡®è®¤æŒ‰é’®');
            const å–æ¶ˆæŒ‰é’® = document.querySelector('.å–æ¶ˆæŒ‰é’®');
            const å¼¹çª—è’™ç‰ˆ = document.querySelector('.å¼¹çª—è’™ç‰ˆ');

            // ä¿®æ”¹ addMultiEventListener å‡½æ•°æ¥æ›´å¥½åœ°å¤„ç†äº‹ä»¶è§¦å‘
            function addMultiEventListener(element, handler) {
                let isProcessing = false;
                let timeoutId;

                // åˆ›å»ºä¸€ä¸ªåŒ…è£…å‡½æ•°æ¥å¤„ç†å®é™…çš„äº‹ä»¶
                const processEvent = (e) => {
                    if (isProcessing) return;
                    isProcessing = true;

                    // é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œå†’æ³¡
                    e.preventDefault();
                    e.stopPropagation();

                    handler(e);

                    timeoutId = setTimeout(() => {
                        isProcessing = false;
                    }, 300); // å‡å°‘é˜²æŠ–æ—¶é—´ä»¥æé«˜å“åº”é€Ÿåº¦
                };

                // ä½¿ç”¨ pointerdownä»¥æ›´å¥½åœ°å¤„ç†è·¨æµè§ˆå™¨å…¼å®¹æ€§
                element.addEventListener('pointerdown', processEvent);
                element.addEventListener('click', (e) => {
                    if (!isProcessing) {
                        processEvent(e);
                    }
                });

                return () => {
                    element.removeEventListener('pointerdown', processEvent);
                    element.removeEventListener('click', processEvent);
                    clearTimeout(timeoutId);
                };
            }

            // æŠ•ç¨¿å—çš„å¤„ç†ä»£ç 
            addMultiEventListener(æŠ•ç¨¿å—, function (e) {
                e.preventDefault();
                showToast('æ­£åœ¨è·³è½¬åˆ°æŠ•ç¨¿é¡µé¢...', 'info');
                setTimeout(() => {
                    window.location.href = 'tougao.html';
                }, 300);
            });

            // åº”ç”¨å—çš„å¤„ç†ä»£ç 
            addMultiEventListener(åº”ç”¨å—, function (e) {
                e.preventDefault();
                showToast('æ­£åœ¨è·³è½¬åˆ°åº”ç”¨é¡µé¢...', 'info');
                setTimeout(() => {
                    window.location.href = 'yingyong.html';
                }, 300);
            });

            // æœç´¢/å–æ¶ˆå—å¤„ç†
            function toggleSearchState() {
                if (æœç´¢å—.id === 'æœç´¢å—') {
                    // åˆ‡æ¢åˆ°æœç´¢çŠ¶æ€
                    æœç´¢å¼¹çª—.classList.add('æ˜¾ç¤º');
                    å¼¹çª—è’™ç‰ˆ.classList.add('active');
                } else {
                    // åˆ‡æ¢åˆ°å–æ¶ˆçŠ¶æ€
                    å½“å‰æœç´¢çŠ¶æ€ = {
                        æ˜¯å¦æœç´¢ä¸­: false,
                        å…³é”®å­—: '',
                        æœç´¢æ¨¡å¼: 'or'
                    };
                    åŠ è½½èµ„æºå—();
                    æœç´¢å—.id = 'æœç´¢å—';
                    æœç´¢å—.querySelector('img').src = 'sousuo.png';
                    æœç´¢å—.querySelector('span').textContent = 'æœç´¢';
                    æœç´¢è¾“å…¥æ¡†.value = '';
                }
            }

            // æœç´¢/å–æ¶ˆå—çš„äº‹ä»¶å¤„ç†
            addMultiEventListener(æœç´¢å—, function (e) {
                e.preventDefault();
                toggleSearchState();
            });

            // ç¡®è®¤æŒ‰é’®å¤„ç†
            addMultiEventListener(ç¡®è®¤æŒ‰é’®, function (e) {
                e.preventDefault();
                let å…³é”®å­— = æœç´¢è¾“å…¥æ¡†.value;

                // å¤„ç†å…³é”®è¯æ›¿æ¢
                å…³é”®å­— = å…³é”®å­—.replace(/æ— æ•ˆ|å¤±æ•ˆ|å¼‚å¸¸|é”™è¯¯|æœ‰é—®é¢˜|æ— ç”¨|ä¸å¯ä»¥ç”¨|ä¸å¯ç”¨|ä¸èƒ½ç”¨/g, 'ğŸ”´');
                å…³é”®å­— = å…³é”®å­—.replace(/æœ‰æ•ˆ|å¯ç”¨|èƒ½ç”¨|å¯ä»¥ç”¨|æœ‰ç”¨|æ— é—®é¢˜|æ­£å¸¸/g, 'â­ï¸');

                const æœç´¢æ¨¡å¼ = å…³é”®å­—.includes('ï¼Œ') || å…³é”®å­—.includes(',') ? 'and' : 'or';

                å½“å‰æœç´¢çŠ¶æ€ = {
                    æ˜¯å¦æœç´¢ä¸­: true,
                    å…³é”®å­—: å…³é”®å­—,
                    æœç´¢æ¨¡å¼: æœç´¢æ¨¡å¼
                };

                æœç´¢èµ„æº(å…³é”®å­—, æœç´¢æ¨¡å¼);
                æœç´¢å¼¹çª—.classList.remove('æ˜¾ç¤º');
                å¼¹çª—è’™ç‰ˆ.classList.remove('active');
                æœç´¢å—.id = 'å–æ¶ˆå—';
                æœç´¢å—.querySelector('img').src = 'quxiao.png';
                æœç´¢å—.querySelector('span').textContent = 'å–æ¶ˆ';
            });

            // å–æ¶ˆæŒ‰é’®å¤„ç†
            addMultiEventListener(å–æ¶ˆæŒ‰é’®, function (e) {
                e.preventDefault();
                æœç´¢è¾“å…¥æ¡†.value = '';
                æœç´¢å¼¹çª—.classList.remove('æ˜¾ç¤º');
                å¼¹çª—è’™ç‰ˆ.classList.remove('active');
            });
        }

        // ç¡®ä¿åªåˆå§‹åŒ–ä¸€æ¬¡
        let isInitialized = false;

        // é¡µé¢åŠ è½½å’Œå‡†å¤‡å°±ç»ªæ—¶åªåˆå§‹åŒ–ä¸€æ¬¡
        document.addEventListener('DOMContentLoaded', function () {
            if (!isInitialized) {
                initializeBottomButtons();
                isInitialized = true;
            }
        });

        // é¡µé¢å®Œå…¨åŠ è½½ååªåˆå§‹åŒ–ä¸€æ¬¡
        window.addEventListener('load', function () {
            if (!isInitialized) {
                initializeBottomButtons();
                isInitialized = true;
            }
            åŠ è½½èµ„æºå—(); // ä¸ç®¡æ˜¯å¦åˆå§‹åŒ–è¿‡ï¼Œéƒ½éœ€è¦åŠ è½½èµ„æºå—
        });

    </script>
    <script src="gonggao/script.js"></script>
</body>

</html>
